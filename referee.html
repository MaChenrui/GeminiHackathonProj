<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>è£åˆ¤ç«¯ â€“ Gemini è’™çœ¼ç«é€Ÿ</title>
<style>
  *{box-sizing:border-box;margin:0;padding:0}
  body{font-family:system-ui,sans-serif;background:#0f172a;color:#e2e8f0;min-height:100vh;padding:16px}
  h1{text-align:center;font-size:1.4rem;margin-bottom:12px;color:#38bdf8}
  .card{background:#1e293b;border-radius:12px;padding:16px;margin-bottom:12px}
  label{display:block;font-size:.8rem;color:#94a3b8;margin-bottom:4px}
  input,textarea{width:100%;background:#0f172a;border:1px solid #334155;border-radius:8px;
    padding:8px 10px;color:#e2e8f0;font-size:.85rem;outline:none}
  input:focus,textarea:focus{border-color:#38bdf8}
  textarea{resize:vertical;min-height:80px}
  .row{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
  button{flex:1;min-width:120px;padding:10px 12px;border:none;border-radius:8px;
    font-size:.85rem;font-weight:600;cursor:pointer;transition:.15s}
  .btn-blue{background:#0ea5e9;color:#fff}
  .btn-blue:hover{background:#38bdf8}
  .btn-green{background:#22c55e;color:#fff}
  .btn-green:hover{background:#4ade80}
  .btn-red{background:#ef4444;color:#fff}
  .btn-red:hover{background:#f87171}
  .btn-gray{background:#334155;color:#e2e8f0}
  .btn-gray:hover{background:#475569}
  button:disabled{opacity:.4;cursor:not-allowed}
  .status-row{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px;font-size:.78rem}
  .dot{display:inline-block;width:8px;height:8px;border-radius:50%;margin-right:4px}
  .dot-ok{background:#22c55e}
  .dot-err{background:#ef4444}
  .dot-idle{background:#64748b}
  .dot-warn{background:#f59e0b}
  #camPreview{width:100%;max-height:240px;border-radius:8px;background:#000;object-fit:cover}
  #connCodeBox{width:100%;background:#0f172a;border:1px solid #334155;border-radius:8px;
    padding:8px 10px;color:#38bdf8;font-size:.78rem;font-family:monospace;word-break:break-all;
    white-space:pre-wrap;min-height:48px;cursor:pointer;user-select:all}
  #logBox{font-size:.75rem;color:#94a3b8;height:100px;overflow-y:auto;
    background:#0f172a;padding:8px;border-radius:6px;margin-top:8px;word-break:break-all}
  .timer{font-size:1.1rem;font-weight:700;color:#fbbf24;text-align:center;margin-top:4px}
</style>
</head>
<body>
<h1>ğŸ† è£åˆ¤ç«¯ â€“ Gemini Live</h1>

<!-- API Key -->
<div class="card">
  <label>Gemini API Key</label>
  <input type="password" id="apiKey" placeholder="AIza..." autocomplete="off">
  <label style="margin-top:8px">æ¨¡å‹ (é»˜è®¤å¯ä¸æ”¹)</label>
  <input type="text" id="modelId" value="models/gemini-2.5-flash-native-audio-preview-12-2025">
</div>

<!-- Prompts -->
<div class="card">
  <label>è£åˆ¤ Game Prompt</label>
  <textarea id="gamePrompt">ä½ æ˜¯ç°åœºè£åˆ¤ AIã€‚ä½ çœ‹åˆ°çš„æ˜¯å…¨æ™¯æ‘„åƒå¤´ç”»é¢ã€‚
ä½ çš„ä»»åŠ¡ï¼š
1ï¼‰å½“ä¸»æŒäººè¯´"å¼€å§‹æ¸¸æˆ"åï¼Œä½ ç«‹åˆ»å¤§å£°å®£å¸ƒï¼šã€Œæ¯”èµ›ç°åœ¨å¼€å§‹ï¼ã€
2ï¼‰æŒç»­ç›‘æ§ç”»é¢ï¼šå¦‚æœæœ‰ç©å®¶æ‘˜çœ¼ç½©æˆ–å·çœ‹ï¼Œç«‹åˆ»ç”¨å£ä»¤ã€Œæš‚åœæ¸¸æˆï¼ŒPlayer X ä½œå¼Šã€å¹¶é‡å¤ä¸¤éã€‚
3ï¼‰ç›‘æ§è°å…ˆç”¨æ‰‹è§¦ç¢°åˆ°å¥–æ¯ï¼Œå®£å¸ƒã€ŒPlayer X è·èƒœï¼Œæ¸¸æˆç»“æŸï¼ã€å¹¶é‡å¤ä¸¤éã€‚
4ï¼‰ä¸è¦è§£é‡Šã€ä¸è¦è¯´é“å¾·ï¼Œåªè¾“å‡ºè£åˆ¤æŒ‡ä»¤ï¼Œç®€çŸ­æœ‰åŠ›ã€‚
5ï¼‰å½“ä½ ä¸ç¡®å®šæ—¶ï¼Œè¯´ã€Œæˆ‘ä¸ç¡®å®šï¼Œè¯·äººå·¥ç¡®è®¤ã€ï¼Œä¸è¦çåˆ¤ã€‚
6ï¼‰æ¯éš” 30 ç§’å·¦å³æ’­æŠ¥ä¸€æ¬¡æ¯”èµ›çŠ¶æ€ï¼ˆå‡ ä½é€‰æ‰‹ç›®å‰å¤§è‡´ä½ç½®ï¼‰ã€‚</textarea>

  <label style="margin-top:10px">ç©å®¶ Player Promptï¼ˆå°†ç”Ÿæˆè¿æ¥ç ï¼‰</label>
  <textarea id="playerPrompt">ä½ æ˜¯æˆ‘çš„çœ¼ç›ä¸å¯¼èˆªï¼Œåªç”¨ä¸­æ–‡çŸ­å¥ã€‚
æˆ‘å·²è’™çœ¼ï¼Œä½ å¿…é¡»ä¼˜å…ˆå®‰å…¨ï¼šè®©æˆ‘æ…¢èµ°ã€éšæ—¶åœä¸‹ã€åŒæ‰‹å‰æ¢ï¼›é‡åˆ°ä¸ç¡®å®šå¿…é¡»è®©æˆ‘åœã€‚
ç›®æ ‡ï¼šæ‰¾åˆ°å¹¶è§¦ç¢°å¥–æ¯ã€‚
æŒ‡ä»¤æ ¼å¼ï¼šæ–¹å‘ï¼‹å°æ­¥æ•°ï¼‹åœï¼ˆä¾‹ï¼šã€Œå‘å·¦ä¸€æ­¥ã€‚åœã€‚å‘å‰ä¸¤å°æ­¥ã€‚åœã€‚ã€ï¼‰ã€‚
æ¯è¿‡10ç§’ä¸»åŠ¨æ ¹æ®æˆ‘ç›®å‰çš„çŠ¶æ€ç»™å‡ºæŒ‡ç¤ºï¼Œæ— éœ€ç­‰æˆ‘å‘é—®ã€‚</textarea>
</div>

<!-- Connection Code -->
<div class="card">
  <div class="row">
    <button class="btn-blue" id="btnGenCode">ç”Ÿæˆè¿æ¥ç </button>
    <button class="btn-gray" id="btnCopyCode" disabled>å¤åˆ¶è¿æ¥ç </button>
  </div>
  <label style="margin-top:10px">è¿æ¥ç ï¼ˆç©å®¶ç²˜è´´åˆ°ç©å®¶é¡µã€Œè¿æ¥ç ã€è¾“å…¥æ¡†ï¼‰</label>
  <div id="connCodeBox">ï¼ˆç‚¹å‡»ã€Œç”Ÿæˆè¿æ¥ç ã€åæ˜¾ç¤ºï¼‰</div>
</div>

<!-- Camera & Live -->
<div class="card">
  <video id="camPreview" autoplay muted playsinline></video>
  <div class="status-row">
    <span><span class="dot dot-idle" id="dotCam"></span>æ‘„åƒå¤´</span>
    <span><span class="dot dot-idle" id="dotLive"></span>Live è¿æ¥</span>
    <span><span class="dot dot-idle" id="dotAudio"></span>AI éŸ³é¢‘</span>
  </div>
  <div class="timer" id="timerDisplay">00:00</div>
  <div class="row" style="align-items:center;margin-top:8px">
    <label style="margin:0;flex:0 0 auto">&#x1F4F9; è§†é¢‘å¸§ç‡</label>
    <select id="fpsSel" style="flex:1;background:#0f172a;border:1px solid #334155;border-radius:8px;
      padding:6px 10px;color:#e2e8f0;font-size:.85rem;margin-left:8px">
      <option value="2000">0.5 fpsï¼ˆçœæµé‡ï¼‰</option>
      <option value="1000" selected>1 fpsï¼ˆé»˜è®¤ï¼‰</option>
      <option value="500">2 fpsï¼ˆæ›´æµç•…ï¼‰</option>
    </select>
  </div>
  <div class="row" style="margin-top:10px">
    <button class="btn-blue" id="btnCam">æˆæƒæ‘„åƒå¤´</button>
    <button class="btn-green" id="btnConnect" disabled>è¿æ¥ Live</button>
    <button class="btn-green" id="btnStart" disabled>ğŸ“¢ å¼€å§‹æ¸¸æˆ</button>
    <button class="btn-red" id="btnStop" disabled>ç»“æŸæ¸¸æˆ</button>
  </div>
</div>

<!-- Log -->
<div class="card">
  <label>æ—¥å¿—</label>
  <div id="logBox"></div>
</div>

<script>
// â”€â”€â”€ DOM refs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const apiKeyEl    = document.getElementById('apiKey');
const modelIdEl   = document.getElementById('modelId');
const gamePromptEl= document.getElementById('gamePrompt');
const playerPromptEl= document.getElementById('playerPrompt');
const camPreview  = document.getElementById('camPreview');
const logBox      = document.getElementById('logBox');
const timerDisplay= document.getElementById('timerDisplay');

const btnGenCode  = document.getElementById('btnGenCode');
const btnCopyCode = document.getElementById('btnCopyCode');
const connCodeBox = document.getElementById('connCodeBox');
const btnCam      = document.getElementById('btnCam');
const btnConnect  = document.getElementById('btnConnect');
const btnStart    = document.getElementById('btnStart');
const btnStop     = document.getElementById('btnStop');

const dotCam   = document.getElementById('dotCam');
const dotLive  = document.getElementById('dotLive');
const dotAudio = document.getElementById('dotAudio');

// â”€â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let ws            = null;
let camStream     = null;
let audioCtx      = null;
let nextPlayTime  = 0;
let videoTimer    = null;
let gameStartTime = null;
let timerInterval = null;
let isRunning     = false;
let totalElapsed  = 0;

// â”€â”€â”€ Log â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function log(msg, type='info'){
  const colors={info:'#94a3b8',ok:'#4ade80',err:'#f87172',warn:'#fbbf24'};
  const d=new Date();
  const ts=`${d.getHours().toString().padStart(2,'0')}:${d.getMinutes().toString().padStart(2,'0')}:${d.getSeconds().toString().padStart(2,'0')}`;
  logBox.innerHTML+=`<span style="color:${colors[type]||colors.info}">[${ts}] ${msg}</span>\n`;
  logBox.scrollTop=logBox.scrollHeight;
}

function setDot(el,state){
  el.className='dot '+(state==='ok'?'dot-ok':state==='err'?'dot-err':state==='warn'?'dot-warn':'dot-idle');
}

// â”€â”€â”€ Connection Code â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
btnGenCode.onclick = () => {
  const txt = playerPromptEl.value.trim();
  if(!txt){alert('ç©å®¶ Prompt ä¸èƒ½ä¸ºç©º');return;}
  const code = btoa(unescape(encodeURIComponent(txt)));
  connCodeBox.textContent = code;
  btnCopyCode.disabled = false;
  log('è¿æ¥ç å·²ç”Ÿæˆï¼Œå…± '+code.length+' å­—ç¬¦','ok');
};

btnCopyCode.onclick = () => {
  const code = connCodeBox.textContent;
  if(!code || code.startsWith('ï¼ˆ')) return;
  navigator.clipboard.writeText(code).then(()=>{
    btnCopyCode.textContent='âœ… å·²å¤åˆ¶';
    log('å·²å¤åˆ¶è¿æ¥ç ','ok');
    setTimeout(()=>{ btnCopyCode.textContent='å¤åˆ¶è¿æ¥ç '; },1500);
  });
};

// â”€â”€â”€ Camera â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
btnCam.onclick = async () => {
  try{
    camStream = await navigator.mediaDevices.getUserMedia({
      video:{facingMode:'environment', width:{ideal:640}, height:{ideal:480}},
      audio:false
    });
    camPreview.srcObject = camStream;
    setDot(dotCam,'ok');
    btnConnect.disabled = false;
    btnCam.textContent = 'âœ… æ‘„åƒå¤´å·²å°±ç»ª';
    btnCam.disabled = true;
    log('æ‘„åƒå¤´æˆæƒæˆåŠŸ','ok');
  }catch(e){
    setDot(dotCam,'err');
    log('æ‘„åƒå¤´æˆæƒå¤±è´¥: '+e.message,'err');
  }
};

// â”€â”€â”€ Audio Playback â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function ensureAudioCtx(){
  if(!audioCtx || audioCtx.state==='closed'){
    audioCtx = new AudioContext({sampleRate:24000});
    nextPlayTime = 0;
  }
  if(audioCtx.state==='suspended') audioCtx.resume();
}

function enqueueAudio(base64data){
  ensureAudioCtx();
  try{
    const bin = atob(base64data);
    const bytes = new Uint8Array(bin.length);
    for(let i=0;i<bin.length;i++) bytes[i]=bin.charCodeAt(i);
    const samples = bytes.length/2;
    const buf = audioCtx.createBuffer(1,samples,24000);
    const ch  = buf.getChannelData(0);
    const view= new DataView(bytes.buffer);
    for(let i=0;i<samples;i++) ch[i]=view.getInt16(i*2,true)/32768;
    const src = audioCtx.createBufferSource();
    src.buffer = buf;
    src.connect(audioCtx.destination);
    const t = Math.max(audioCtx.currentTime+0.01, nextPlayTime);
    src.start(t);
    nextPlayTime = t + buf.duration;
    setDot(dotAudio,'ok');
  }catch(e){ log('éŸ³é¢‘æ’­æ”¾é”™è¯¯:'+e.message,'err'); }
}

function clearAudioQueue(){
  if(audioCtx){ audioCtx.close(); audioCtx=null; nextPlayTime=0; }
  setDot(dotAudio,'idle');
  log('å·²æ‰“æ–­éŸ³é¢‘æ’­æ”¾é˜Ÿåˆ—','warn');
}

// â”€â”€â”€ Video Frame Capture â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const captureCanvas = document.createElement('canvas');
captureCanvas.width  = 320;
captureCanvas.height = 240;
const captureCtx2d  = captureCanvas.getContext('2d');

function startVideoCapture(){
  const interval = parseInt(document.getElementById('fpsSel').value)||1000;
  videoTimer = setInterval(()=>{
    if(!camStream||!ws||ws.readyState!==1) return;
    if(!camPreview.videoWidth||!camPreview.videoHeight) return; // not ready yet
    captureCtx2d.drawImage(camPreview, 0, 0, 320, 240);
    const jpeg = captureCanvas.toDataURL('image/jpeg',0.5);
    const base64 = jpeg.split(',')[1];
    wsSend({realtimeInput:{video:{data:base64, mimeType:'image/jpeg'}}});
  }, interval);
}

function stopVideoCapture(){
  clearInterval(videoTimer);
  videoTimer = null;
}

// â”€â”€â”€ Timer UI â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function startTimer(){
  gameStartTime = Date.now() - totalElapsed*1000;
  timerInterval = setInterval(()=>{
    const s = Math.floor((Date.now()-gameStartTime)/1000);
    totalElapsed = s;
    const m = Math.floor(s/60);
    timerDisplay.textContent = `${String(m).padStart(2,'0')}:${String(s%60).padStart(2,'0')}`;
  },500);
}

function stopTimer(){ clearInterval(timerInterval); timerInterval=null; }

// â”€â”€â”€ WebSocket helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function wsSend(obj){
  if(ws&&ws.readyState===1) ws.send(JSON.stringify(obj));
}

// â”€â”€â”€ Live Connection â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function connectLive(){
  const key   = apiKeyEl.value.trim();
  const model = modelIdEl.value.trim()||'models/gemini-2.5-flash-native-audio-preview-12-2025';
  if(!key){alert('è¯·è¾“å…¥ API Key');return;}

  const url = `wss://generativelanguage.googleapis.com/ws/google.ai.generativelanguage.v1beta.GenerativeService.BidiGenerateContent?key=${encodeURIComponent(key)}`;
  ws = new WebSocket(url);
  setDot(dotLive,'warn');
  log('æ­£åœ¨è¿æ¥ Live...','warn');

  ws.onopen = () => {
    setDot(dotLive,'ok');
    log('WebSocket å·²è¿æ¥','ok');

    const systemText = gamePromptEl.value.trim();

    // Setup message
    wsSend({
      setup:{
        model,
        generationConfig:{
          responseModalities:['AUDIO'],
          mediaResolution:'MEDIA_RESOLUTION_LOW',
          speechConfig:{voiceConfig:{prebuiltVoiceConfig:{voiceName:'Aoede'}}},
          thinkingConfig:{thinkingBudget:0}
        },
        systemInstruction:{parts:[{text:systemText}]}
      }
    });
    log('å·²å‘é€ setup','ok');

    startVideoCapture();
  };

  ws.onmessage = async (evt) => {
    let data = evt.data;
    if(data instanceof Blob) data = await data.text();
    let msg;
    try{ msg=JSON.parse(data); }catch(e){ log('JSONè§£æå¤±è´¥: '+e.message,'err'); return; }

    if(msg.error){
      log('APIé”™è¯¯ '+msg.error.code+': '+msg.error.message,'err');
      return;
    }

    if(msg.serverContent?.interrupted){
      clearAudioQueue();
      return;
    }
    if(msg.serverContent?.modelTurn?.parts){
      for(const part of msg.serverContent.modelTurn.parts){
        if(part.inlineData?.mimeType?.startsWith('audio/')){
          enqueueAudio(part.inlineData.data);
        }
        if(part.text) log('AI: '+part.text,'ok');
      }
    }
    if(msg.setupComplete){
      log('Setup å®Œæˆï¼ŒLive å°±ç»ª','ok');
    }
  };

  ws.onerror = () => { setDot(dotLive,'err'); log('WS é”™è¯¯','err'); };
  ws.onclose = (e) => {
    setDot(dotLive,'idle');
    stopVideoCapture();
    setDot(dotAudio,'idle');
    log(`WS å·²å…³é—­ (code=${e.code})`, e.code===1000?'info':'warn');
    // Reconnect whenever isRunning (covers 2-min server timeout = code 1000)
    if(isRunning){
      log('3ç§’åè‡ªåŠ¨é‡è¿...','warn');
      setTimeout(()=>connectLive(),3000);
    }
  };
}

// â”€â”€â”€ Buttons â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
btnConnect.onclick = () => {
  isRunning = true;
  totalElapsed = 0;
  connectLive();
  startTimer();
  btnConnect.disabled = true;
  btnStart.disabled   = false;
  btnStop.disabled    = false;
};

btnStart.onclick = () => {
  // Send a text turn to trigger Gemini to announce game start
  wsSend({clientContent:{turns:[{role:'user',parts:[{text:'ä¸»æŒäººè¯´ï¼šç°åœ¨å¼€å§‹æ¸¸æˆï¼è¯·ä½ å®£å¸ƒæ¯”èµ›å¼€å§‹ã€‚'}]}], turnComplete:true}});
  log('å·²å‘é€"å¼€å§‹æ¸¸æˆ"æŒ‡ä»¤','ok');
};

btnStop.onclick = () => {
  isRunning = false;
  stopVideoCapture();
  stopTimer();
  if(ws){ ws.close(1000,'user stop'); ws=null; }
  clearAudioQueue();
  setDot(dotLive,'idle');
  btnConnect.disabled = false;
  btnStart.disabled   = true;
  btnStop.disabled    = true;
  log('æ¸¸æˆç»“æŸï¼Œè¿æ¥å·²å…³é—­','warn');
};

// â”€â”€â”€ Restore API key from localStorage â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
apiKeyEl.value = localStorage.getItem('gemini_api_key')||'';
apiKeyEl.addEventListener('input',()=>localStorage.setItem('gemini_api_key',apiKeyEl.value));

log('è£åˆ¤ç«¯å°±ç»ªã€‚è¯·å…ˆè¾“å…¥ API Key â†’ æˆæƒæ‘„åƒå¤´ â†’ è¿æ¥ Liveã€‚','ok');
</script>
</body>
</html>
